---
title: "Logistic_models"
author: "Madyline Lawrence"
date: "7/14/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
# Importing packages needed

library(gdata)
library(ggplot2)
library(stringr)
library(boot)
library(data.table)
library(dplyr)
library(formattable)
library(tidyr)
library(caret)
library(questionr)
library(DescTools)
library(survival)
```

```{r, echo = FALSE}
rm(list=ls()) #removes all old variables

#import the dataset
efdata = read.csv("E.fae data.csv")
smdata = read.csv("S.m data.csv")

ef.bygroup = distinct(efdata, scientist,rep, primary, secondary_dose, X0.hour, X10.hour, log10_10hour)
sm.bygroup = distinct(smdata, scientist, rep, primary, secondary_dose, X0.hour, X10.hour, log10_10hour)
```

#E.Fae Data:
##Logistic Graph by chronic infection status Significance:
```{r, echo = FALSE}
PBS = efdata[efdata$primary == "PBS",]
PBSlogit = glm(formula = alive3 ~ log10_10hour, family = "binomial", data = PBS)
summary(PBSlogit)
PseudoR2(PBSlogit)
Cstat(PBSlogit)
bact_val = seq(2,9,0.01)
PBS_preds <- predict(PBSlogit, list(log10_10hour = bact_val), type = "response", se.fit = TRUE)

Efae = efdata[efdata$primary == "E.fae",]
Efaelogit = glm(formula = alive3 ~ log10_10hour, family = "binomial", data = Efae)
summary(Efaelogit)
Cstat(Efaelogit)
Efae_preds <- predict(Efaelogit, list(log10_10hour = bact_val), type = "response")
```

##Values of Interest
PBS curve point of inflection = 3.6822
PBS hill slope = -0.15480
E.fae curve point of inflection = 4.56533
E.fae hill slope = -0.13400

## Logistic Model Including Interaction Significance
```{r, echo = FALSE}
mylogit = glm(formula = bin_alive3 ~ log10_10hour + bin_primary + (bin_primary*log10_10hour), family = "binomial", data = efdata)
summary(mylogit)
Cstat(mylogit)
```

E.FAE IMAGES:
```{r, echo = FALSE}
PBS = efdata[efdata$primary == "PBS",]
PBSlogit = glm(formula = alive3 ~ log10_10hour, family = "binomial", data = PBS)
summary(PBSlogit)
PseudoR2(PBSlogit)
Cstat(PBSlogit)
bact_val = seq(2,9,0.01)

PBS_preds <- predict(PBSlogit, list(log10_10hour = bact_val), type = "response",se.fit =TRUE)
PBS_upper = (PBS_preds$fit+1.96*PBS_preds$se.fit)
PBS_lower = (PBS_preds$fit-1.96*PBS_preds$se.fit)

Efae = efdata[efdata$primary == "E.fae",]
Efaelogit = glm(formula = alive3 ~ log10_10hour, family = "binomial", data = Efae)
summary(Efaelogit)
Cstat(Efaelogit)

Efae_preds <- predict(Efaelogit, list(log10_10hour = bact_val), type = "response",se.fit = TRUE)
Efae_upper = (Efae_preds$fit+(1.96*Efae_preds$se.fit))
Efae_lower = (Efae_preds$fit-(1.96*Efae_preds$se.fit))


png(file="figure6_abbyfrank.png", width = 1500, height = 1500, res = 300)
par(family = "Times")
plot(0,0,xlim = c(2,9),ylim = c(0,1),type = "n",ylab= "Probability of Survival", xlab = expression("Log"[10]*"(10 Hour Bacterial Load)"))
lines(PBS_preds$fit~bact_val,col="steelblue4", lwd = 2)
lines(Efae_preds$fit~bact_val, col="steelblue2", lwd = 2)

legend("topright", inset=.03, title="Primary Infection Group",c("PBS","E.faecalis"), fill=c("steelblue4","steelblue2"), horiz=TRUE,cex = 0.75)
lines(bact_val, PBS_upper, lty=2, col="steelblue4")
lines(bact_val, PBS_lower, lty=2,col="steelblue4")
lines(bact_val, Efae_upper, lty=2, col="steelblue2")
lines(bact_val, Efae_lower, lty=2, col="steelblue2")
dev.off()
```

#SM DATA:
##Logistic Graph by chronic infection status:
```{r, echo = FALSE}
PBS = smdata[smdata$primary == "PBS",]
PBSlogit = glm(formula = alive3 ~ log10_10hour, family = "binomial", data = PBS)
summary(PBSlogit)
PseudoR2(PBSlogit)
Cstat(PBSlogit)
bact_val = seq(2,9,0.01)
PBS_preds <- predict(PBSlogit, list(log10_10hour = bact_val), type = "response")

SM = smdata[smdata$primary == "S.M",]
SMlogit = glm(formula = alive3 ~ log10_10hour, family = "binomial", data = SM)
summary(SMlogit)
Cstat(SMlogit)
SM_preds <- predict(SMlogit, list(log10_10hour = bact_val), type = "response")

#ggplot() + geom_line(aes(x = bact_val, y = PBS_preds, colour = "PBS")) + geom_line(aes(x = bact_val, y = SM_preds, colour = "SM")) + ylab("Probability of Survival") + xlab("Log (10 Hour Bacteria Amount)") 
```


##Values of Interest
PBS curve point of inflection = 3.6981
PBS hill slope = -0.26585
S.M curve point of inflection = 5.71890
S.M hill slope = -0.10105
## Logistic Model Including Interaction Significance
```{r, echo = FALSE}
mylogit = glm(formula = bin_alive3 ~ log10_10hour + bin_primary + (bin_primary*log10_10hour), family = "binomial", data = smdata)
summary(mylogit)
Cstat(mylogit)
```

SM IMAGES:
```{r, echo = FALSE}
PBS = smdata[smdata$primary == "PBS",]
PBSlogit = glm(formula = alive3 ~ log10_10hour, family = "binomial", data = PBS)
summary(PBSlogit)
PseudoR2(PBSlogit)
Cstat(PBSlogit)
bact_val = seq(2,9,0.01)

PBS_preds <- predict(PBSlogit, list(log10_10hour = bact_val), type = "response", se.fit = TRUE)
PBS_upper = (PBS_preds$fit+(1.96*PBS_preds$se.fit))
PBS_lower = (PBS_preds$fit-(1.96*PBS_preds$se.fit))

SM = smdata[smdata$primary == "S.M",]
SMlogit = glm(formula = alive3 ~ log10_10hour, family = "binomial", data = SM)
summary(SMlogit)
Cstat(SMlogit)

SM_preds <- predict(SMlogit, list(log10_10hour = bact_val), type = "response", se.fit = TRUE)
SM_upper = (SM_preds$fit+(1.96*SM_preds$se.fit))
SM_lower = (SM_preds$fit-(1.96*SM_preds$se.fit))

png(file="figure13_abbyfrank.png", width = 1500, height = 1500, res = 300)
par(family = "Times")
plot(0,0,xlim = c(2,9),ylim = c(0,0.9),type = "n",ylab= "Probability of Survival", xlab = expression("Log"[10]*"(10 Hour Bacterial Load)"))
polygon(c(bact_val, rev(bact_val)), c(PBS_upper, rev(PBS_lower)), border = NA, col = adjustcolor("gray", alpha.f=0.5))
polygon(c(bact_val, rev(bact_val)), c(SM_upper, rev(SM_lower)), border = NA, col = adjustcolor("#055df5", alpha.f=0.5))
lines(PBS_preds$fit~bact_val,col="gray", lwd = 2)
lines(SM_preds$fit~bact_val, col="#055df5", lwd = 2)

legend("topright", title= NA, c("PBS","S.marcescens"), col=c("#055df5","gray"), lwd = 3, cex = 1)
lines(bact_val, PBS_upper, lty=2, col=adjustcolor("gray", alpha.f=0.5))
lines(bact_val, PBS_lower, lty=2, col=adjustcolor("gray", alpha.f=0.5))
lines(bact_val, SM_upper, lty=2, col=adjustcolor("#055df5", alpha.f=0.5))
lines(bact_val, SM_lower, lty=2, col=adjustcolor("#055df5", alpha.f=0.5))

dev.off()
```

```{r}
# Significance of control vs efae
mylogit = glm(formula = alive3 ~ log10_10hour + primary, family = "binomial", data = efdata)
summary(mylogit)

# Significance of control vs sm
mylogit = glm(formula = alive3 ~ log10_10hour + primary, family = "binomial", data = smdata)
summary(mylogit)
```